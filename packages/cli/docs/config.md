---
sidebar_position: 2
---

`@tramvai/cli` requires that in the project root should exists config file named `tramvai.json`. This config should define projects that `@tramvai/cli` should handle.

## config file format

```json
{
  "projects": {
    "react-app": {
      "name": "new-app",
      "root": "src",
      "type": "application",
      "commands": {
        "build": {
          "options": { ... },
          "configurations": { ... }
        },
        "serve": {
          "configurations": { ... }
        }
      }
    }
  }
}
```

- `projects` - map of the projects that resides in the current repository. `@tramvai/cli` supports many apps and packages inside single repository (so called monorepo concept).

## Поддержка JSON схемы файла конфигурации в IDE

## JSON schema validation and autocomplete in IDEs

Link to the actual json schema for the `tramvai.json` is `./node_modules/@tramvai/cli/schema.json`

The most simple way to add config validation and autocomplete is to add schema through field `$schema` inside `tramvai.json`:

```json
{
  "$schema": "./node_modules/@tramvai/cli/schema.json",
  "projects": {}
}
```

Another way is to add schema to the IDE settings:

How to add schema to the **JetBrains IDE** you can find in the [official docs](https://www.jetbrains.com/help/idea/json.html#ws_json_schema_add_custom). You also need to set `tramvai.json` as file path pattern in settings.

How to add schema to the **VSCode** you can find in the [official docs](https://code.visualstudio.com/docs/languages/json#_json-schemas-and-settings)

> New projects generated by `tramvai new` command already has field `$schema` in their `tramvai.json` config.

## Настройки для build этапа

```json
"commands": {
  "build": {
    "options": {
      "polyfill": "", // path to the polyfill file with all of the required polyfills. If not provided polyfill bundle will not be generated
      "server": "src/server",  // path to the server entry point
      "outputServer": "dist/server", // folder to output server bundle
      "outputClient": "dist/client"  // folder to output client bundle
    },
    "configurations": {
      "commonChunk": true, // enables generation common chunk that includes shared code between chunks
      "commonChunkSplitNumber": 3, // number of different chunks that should link to code in order to put that code in commonChunk
      "sourceMap": false, // is client sourcemaps are enabled
      "sourceMapServer": false, // is server sourcemaps are enabled
      "modern": true, // enable separate client bundle for the modern browsers only
      "checkAsyncTs": false, // enables background type checks
      "terserParallel": true, // enables parallel terser compression
      "granularChunks": false, // enables splitting commonChunk to many independent pieces. It may significantly reduce js size on some pages
      "granularChunksSplitNumber": 2, // number of duplicates before move code to the granular chunk
      "generateDataQaTag": false, // @deprecated automatically generate unique id for react components
      "definePlugin": { // replaces passed strings with passed values in the build time
        "prod": {},
        "dev": {}
      },
      "threadLoader": { // config for the multithread build process (https://webpack.js.org/loaders/thread-loader/).
      },
      "postcss": { // config for the postcss-loader
        "cssLocalIdentName": "[hash:base64:5]", // specifies identifier for the css class names
        "config": "postcss.config" // path to the postcss.config file
      },
      "alias": {}, // alias config. More details in the [docs](https://www.npmjs.com/package/babel-plugin-module-resolver)
      "removeTypeofWindow": true, // enables babel plugin transform-define that will replace code `typeof window` to 'undefined' or 'object' depending on the environment
      "dedupe": "equality" | "semver" | false, // controls the deduplication plugin
      "svgo": {
        "plugins": [{ "cleanupIDs": false }, { "collapseGroups": false }], // svgo plugins (https://github.com/svg/svgo#what-it-can-do)
      },
      "imageOptimization": { // config for the process of the image optimizations
        enabled: true, // enable image optimization
        options: {} // options for the detailed settings (https://github.com/tcoopman/image-webpack-loader#options)
      }
    }
  }
}
```

## Add new config parameters

Config parameters for the `@tramvai/cli` are stored as TypeScript interface from which JSON Schema is generating. This schema is used for the config validation and applying config defaults, thanks to the library [ajv](https://github.com/ajv-validator/ajv).
